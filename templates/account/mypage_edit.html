{% extends "base.html" %}

{% load account %}

{% block content %}
  <div class="container">
    <form class="login" method="POST" action="{% url 'accounts:mypage_update' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="form-group">
        <input type="file" name="icon">
        {% if user.profile.icon != "" %}
        <img id="icon_preview" src="{{user.profile.icon}}" style="width:300px;height:300px;" />
        {% else %}
        <img id="icon_preview" style="width:300px;height:300px;" />
        {% endif %}
      </div>
      <div class="form-group">
        <label for="name">Name</label>
        <input name="name" type="name" class="form-control" value="{{user.username}}">
      </div>
      <div class="form-group">
        <label for="email">Email</label>
        <input name="email" type="email" class="form-control" value="{{user.email}}">
      </div>
      <div class="form-group">
        <label for="bio">Bio</label>
        <textarea name="bio" type="text" class="form-control">{{user.profile.bio}}</textarea>
      </div>
      <button type="submit" class="btn btn-primary">Update</button>
    </form>
  </div>

  <script type="text/javascript">
    $(document).ready(function() {
      $('input[type="file"]').on("change", function(e) {
        let file = e.target.files[0];
        let reader = new FileReader();

        if(file.type.indexOf("image") < 0){
          alert("画像ファイルを指定してください。");
          return false;
        }

        console.log(e.target);

        reader.onload = (function(file){
          return function(e){
            $("#icon_preview").attr("src", e.target.result);
          };
        })(file);
        reader.readAsDataURL(file);
      });
    });
  </script>
{% endblock %}
