{% extends "base.html" %}

{% block content %}

<div class="container mt-5">

  <form method="get" action="{% url 'restaurants:index' %}">
      <div class="form-row">
          <div class="form-group col-md-6">
              {% if keyword %}
                <input name="keyword" type="text" class="form-control" value="{{ keyword }}">
              {% else %}
                <input name="keyword" type="text" class="form-control">
              {% endif %}
          </div>
          <div class="form-group col-md-2">
              <button type="submit" class="btn btn-success">検索</button>
          </div>
      </div>
  </form>

  <div class="row">
    {% for restaurant in restaurant_list %}
      <div class="col-4 mt-4 d-flex justify-content-center">
          <div class="card w-100">
              {% if restaurant.image != None %}
              <img src="{{ MEDIA_URL }}{{ restaurant.image }}" class="img-fluid">
              {% else %}
              <svg class="bd-placeholder-img img-fluid" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Image cap"><title>Placeholder</title><rect width="100%" height="100%" fill="#868e96"/><text x="45%" y="50%" fill="#dee2e6" dy=".3em">No Image</text></svg>
              {% endif %}
              <div class="card-body">
                <p>平均評価: {{ restaurant.review_avg_score }}</p>
                <h5 class="card-title">{{ restaurant.name }}</h5>
                <p class="card-text">{{ restaurant.address }}</p>
                <a href="{% url 'restaurants:detail' restaurant.id %}" class="btn btn-primary">お店詳細へ</a>
              </div>
            </div>
      </div>
    {% endfor %}
  </div>

  <hr class="my-3 mt-5 mb-5">

  <nav aria-label="Page navigation example">
      <ul class="pagination d-flex justify-content-center">
        {% if restaurant_list.has_previous %}
          <li class="page-item">
            {% if keyword %}
              <a class="page-link" href="?page={{ restaurant_list.previous_page_number }}&keyword={{ keyword }}">前のページ</a>
            {% else %}
              <a class="page-link" href="?page={{ restaurant_list.previous_page_number }}">前のページ</a>
            {% endif %}
          </li>
        {% endif %}
        {% for page_num in restaurant_list.paginator.page_range %}
            {% if page_num == restaurant_list.number %}
              <li class="page-item active">
                {% if keyword %}
                  <a class="page-link" href="?page={{ page_num }}&keyword={{ keyword }}">{{page_num}}</a>
                {% else %}
                  <a class="page-link" href="?page={{ page_num }}">{{page_num}}</a>
                {% endif %}
              </li>
            {% else %}
              <li class="page-item">
                {% if keyword %}
                  <a class="page-link" href="?page={{ page_num }}&keyword={{ keyword }}">{{page_num}}</a>
                {% else %}
                  <a class="page-link" href="?page={{ page_num }}">{{page_num}}</a>
                {% endif %}
              </li>
            {% endif %}
          </li>
        {% endfor %}
        {% if restaurant_list.has_next %}
          <li class="page-item">
            {% if keyword %}
              <a class="page-link" href="?page={{ restaurant_list.paginator.num_pages }}&keyword={{ keyword }}">次のページ</a>
            {% else %}
              <a class="page-link" href="?page={{ restaurant_list.paginator.num_pages }}">次のページ</a>
            {% endif %}
          </li>
        {% endif %}
      </ul>
  </nav>

  <hr class="my-3 mt-5 mb-5">
</div>

{% endblock %}
